## Tổng quan Use Case & Domain Model

### Khái niệm cơ bản
- **Use Case**: Mô tả cách một tác nhân tương tác với hệ thống để đạt một mục tiêu cụ thể.
- **Actor (Tác nhân)**: Thực thể bên ngoài tương tác với hệ thống (ví dụ: Learner, Instructor, Admin).
- **Basic Flow**: Luồng các bước chính khi mọi thứ diễn ra thuận lợi, không có nhánh lỗi.
- **Domain Model**: Mô hình hóa các khái niệm, thực thể và mối quan hệ trong miền nghiệp vụ.
- **Aggregate**: Cụm các thực thể liên kết logic với nhau, có ranh giới nhất quán và một Aggregate Root quản lý.
- **Domain Service**: Nơi đặt logic nghiệp vụ không thuộc về một Entity/Aggregate cụ thể, thường phụ thuộc vào các interface/abstraction.

### 1. Mô tả Use Case (Ánh xạ từ User Stories)
Use case làm rõ các bước tương tác giữa Actor và hệ thống; là cơ sở cho các Sequence Diagram ở bước 1.4.

| Usecase ID | Tên Usecase                            | Mục đích                                                                         | Tác nhân   | FR liên quan | Luồng Cơ bản (Basic Flow) |
|------------|----------------------------------------|----------------------------------------------------------------------------------|------------|--------------|---------------------------|
| **UC-01**  | Đăng ký Tài khoản                      | Tạo tài khoản mới trong hệ thống.                                               | Learner, Instructor, Admin | FR1 | 1. User truy cập trang đăng ký. 2. Nhập email, password, chọn role (Learner/Instructor). 3. Hệ thống validate và tạo tài khoản. 4. Gửi email xác nhận. 5. User xác nhận email và kích hoạt tài khoản. |
| **UC-02**  | Đăng nhập & Xác thực                   | Cho phép người dùng đăng nhập và truy cập hệ thống.                              | Learner, Instructor, Admin | FR1, FR11 | 1. User nhập email và password. 2. Hệ thống xác thực thông tin. 3. Kiểm tra role và phân quyền (RBAC). 4. Tạo session và chuyển đến dashboard tương ứng với role. |
| **UC-03**  | Cập nhật Hồ sơ & Cài đặt Học tập       | Learner cập nhật thông tin cá nhân và tùy chọn học tập.                          | Learner    | FR2 | 1. Learner truy cập trang hồ sơ. 2. Cập nhật tên, tuổi, trình độ, sở thích, mục tiêu, lịch học. 3. Thiết lập nhắc nhở (email/push). 4. Hệ thống lưu thông tin vào LearnerProfile. |
| **UC-04**  | Thực hiện Bài kiểm tra Đầu vào        | Đánh giá kiến thức ban đầu để xây dựng Learner Model.                            | Learner    | FR2, FR5 | 1. Learner bắt đầu diagnostic test. 2. Hệ thống hiển thị câu hỏi đa dạng về kỹ năng. 3. Learner trả lời. 4. Hệ thống chấm điểm và tạo SkillMasteryScore. 5. Kết quả lưu vào LearnerModel. |
| **UC-05**  | Tạo Khóa học & Nội dung Học tập        | Instructor tạo khóa học, chương, bài học với đa dạng định dạng.                  | Instructor | FR3 | 1. Instructor tạo khóa học mới. 2. Tạo chương và bài học (text, video, slide, quiz, coding task). 3. Cấu hình versioning và phân quyền (public/private/group). 4. Lưu vào ContentAggregate. |
| **UC-06**  | Gắn Metadata & Tagging cho Nội dung   | Instructor gắn metadata để hỗ trợ thuật toán AI.                                 | Instructor | FR3, FR4 | 1. Instructor chọn nội dung đã tạo. 2. Gắn tags: kỹ năng, độ khó, chủ đề. 3. Hệ thống lưu MetadataTag. 4. ContentMetadata có sẵn cho Adaptive Engine. |
| **UC-07**  | Cấu hình Lộ trình Khóa học             | Instructor thiết lập mục tiêu, milestones, điều kiện mở khóa bài học.            | Instructor | FR4 | 1. Instructor định nghĩa mục tiêu khóa học và kỹ năng yêu cầu. 2. Thiết lập pre-test, post-test. 3. Cấu hình điều kiện mở khóa (ví dụ: ≥70% điểm quiz). 4. Lưu cấu trúc lộ trình. |
| **UC-08**  | Bắt đầu/Tiếp tục Học tập Thích ứng     | Cung cấp bài học tiếp theo tối ưu dựa trên Learner Model.                        | Learner    | FR7, FR4 | 1. Learner yêu cầu bài học tiếp theo. 2. Hệ thống gọi Adaptive Engine (FR7). 3. Engine đọc LearnerModel và ContentMetadata. 4. Đề xuất ContentID tối ưu (spaced repetition, mastery-based). 5. Hiển thị nội dung. |
| **UC-09**  | Làm Bài tập & Assessment               | Learner thực hiện bài tập (MCQ, essay, coding, upload, project).                 | Learner    | FR5 | 1. Learner mở bài tập. 2. Đọc đề và trả lời (trong thời gian giới hạn nếu có). 3. Submit câu trả lời. 4. Hệ thống lưu vào gradebook. |
| **UC-10**  | Chấm điểm & Phản hồi Tức thì           | Hệ thống chấm điểm và cung cấp phản hồi/gợi ý ngay lập tức.                      | Learner    | FR5, FR6 | 1. Learner gửi câu trả lời (FR5). 2. Scoring/Feedback Service chấm điểm (auto-grading hoặc manual review). 3. Tạo feedback, hints, giải thích đáp án. 4. Hiển thị Score và Hint (< 500ms). 5. Cập nhật LearnerModel. |
| **UC-11**  | Gợi ý Bài học Bù (Remediation)         | Đề xuất bài học bổ sung khi Learner yếu kỹ năng.                                 | Learner    | FR6, FR7 | 1. Hệ thống phát hiện kỹ năng yếu từ LearnerModel. 2. FeedbackGenerator tạo gợi ý bài học liên quan. 3. Hiển thị danh sách bài học bù với hướng dẫn step-by-step. 4. Learner chọn bài học để học lại. |
| **UC-12**  | Xem Dashboard & Tiến độ Học tập        | Learner xem tiến độ, điểm số, milestones.                                        | Learner    | FR8 | 1. Learner truy cập dashboard. 2. Hệ thống hiển thị tiến độ, điểm số, lịch học, milestones, skill mastery. 3. Learner có thể xuất báo cáo (CSV/PDF). |
| **UC-13**  | Xem Báo cáo Tổng hợp Lớp               | Instructor xem tổng quan hiệu suất của cả lớp.                                   | Instructor | FR8 | 1. Instructor chọn lớp. 2. Hệ thống tạo báo cáo tổng hợp: điểm trung bình, điểm yếu phổ biến, phân bố kỹ năng. 3. Instructor phân tích và điều chỉnh nội dung. |
| **UC-14**  | Tạo Báo cáo Chi tiết Học sinh          | Instructor tạo báo cáo cá nhân hóa cho một học sinh.                              | Instructor | FR8 | 1. Instructor chọn học sinh. 2. Hệ thống truy xuất LearnerModel, ProgressRecord. 3. Tạo báo cáo: lộ trình học, điểm mạnh/yếu, thời gian học. 4. Xuất PDF/CSV để tư vấn one-on-one. |
| **UC-15**  | Tương tác & Thảo luận                  | Learner/Instructor tham gia thảo luận, chat, bình luận.                          | Learner, Instructor | FR9 | 1. User truy cập diễn đàn hoặc bài học. 2. Gửi comment/câu hỏi. 3. Hệ thống gửi thông báo realtime (in-app/email/push) cho người liên quan. 4. User khác trả lời. |
| **UC-16**  | Quản lý Lớp & Phân nhóm                | Instructor tạo lớp, mời học sinh, chia nhóm.                                     | Instructor | FR10 | 1. Instructor tạo lớp mới. 2. Mời học sinh qua email/link. 3. Phân vai trò (TA, student, observer). 4. Chia nhóm cho project. 5. Giao bài nhóm và đánh giá theo nhóm. |
| **UC-17**  | Quản lý Người dùng & Phân quyền (RBAC) | Admin quản lý tài khoản và phân quyền chi tiết.                                  | Admin      | FR1, FR11 | 1. Admin truy cập trang quản lý users. 2. Tạo/sửa/xóa tài khoản. 3. Gán role và permissions. 4. Mọi thao tác ghi vào audit logs. 5. User chỉ truy cập tính năng được phép. |
| **UC-18**  | Hoán đổi Mô hình AI (Live Swap)        | Triển khai phiên bản AI mới không downtime.                                      | Admin      | FR12 | 1. Admin yêu cầu triển khai Model V2. 2. Deployment Service chạy V2 song song với V1. 3. Traffic chuyển dần sang V2 (Blue/Green/Canary). 4. Monitoring kiểm tra health. 5. Ngừng V1 khi V2 ổn định. |
| **UC-19**  | Giám sát & Vận hành Hệ thống           | Admin quản lý cấu hình, backup, logs, moderation.                                | Admin      | FR12 | 1. Admin truy cập admin panel. 2. Kiểm tra health checks, logs hệ thống. 3. Thực hiện backup/restore dữ liệu. 4. Xử lý báo cáo vi phạm (moderation). 5. Cấu hình hệ thống (feature flags, limits). |
| **UC-20**  | Nhận Phần thưởng & Gamification        | Learner nhận XP, badges, tham gia leaderboard.                                   | Learner    | FR13 | 1. Learner hoàn thành bài học/milestone. 2. Hệ thống tính XP, trao badge. 3. Cập nhật leaderboard. 4. Hiển thị streak learning, challenge mode. 5. Learner được động viên tiếp tục học. |

### 2. Mô hình hóa Domain chi tiết (ERD/Domain Model)

#### Vai trò chiến lược của Domain Model
Phần Mô hình hóa Domain chi tiết không chỉ là sơ đồ ERD tĩnh mà là **khung tư duy chiến lược** giúp ra quyết định kiến trúc ở cấp độ vĩ mô và vi mô. Nó đóng vai trò là **cầu nối giữa yêu cầu nghiệp vụ và cấu trúc kỹ thuật**, giải quyết 4 vấn đề cốt lõi:

**1. Phân rã hệ thống thành các Service/Component độc lập**
   - Xác định **ranh giới (boundaries)** dựa trên ngữ nghĩa nghiệp vụ
   - Tạo cơ sở cho kiến trúc Microservices/Service-based (AC1: Modularity)

**2. Áp dụng nghiêm ngặt SOLID Principles**
   - **SRP**: Tách Aggregates để mỗi phần chỉ có một lý do thay đổi
   - **DIP**: Policy modules phụ thuộc vào Interface, không phải Concretion
   - **OCP**: Thiết kế cho phép mở rộng không sửa code hiện tại

**3. Đảm bảo Testability & Maintainability (AC4)**
   - Tách Domain Services khỏi Aggregates để dễ Mock/Test
   - Logic nghiệp vụ độc lập với công nghệ I/O

**4. Hỗ trợ ra quyết định kiến trúc**
   - Cung cấp lý do căn cứ để chọn Architecture Pattern
   - Đánh giá Chỉ số Bất ổn (I) và phụ thuộc (Afferent/Efferent Coupling)

#### A. Core Aggregates và Entities

##### Khái niệm Aggregate
- **Aggregate**: Cụm các thực thể liên kết logic với nhau, có **ranh giới nhất quán** và một **Aggregate Root** quản lý.
- **Aggregate Root**: Entity chính làm điểm truy cập duy nhất cho toàn bộ Aggregate, đảm bảo tính toàn vẹn dữ liệu.
- **Vai trò kiến trúc**: Mỗi Aggregate là ứng viên tiềm năng để trở thành một **Microservice** hoặc **Bounded Context** riêng.

| Tên Domain Aggregate   | Core Entities                             | Vai trò & Quyết định Kiến trúc |
|------------------------|-------------------------------------------|--------------------------------|
| **LearnerAggregate**   | Learner, LearnerProfile, ProgressRecord   | **Vai trò**: Quản lý thông tin cá nhân, tiến trình học tập của người dùng (FR2). <br>**Quyết định**: Tách thành **Learner Service** để xử lý CRUD profile. <br>**SOLID**: SRP - chỉ quản lý dữ liệu người dùng, không chứa logic AI. <br>**Stability**: I ≈ 0.3 (vừa phải) vì nhiều service đọc nhưng ít thay đổi. |
| **LearnerModelAggregate** | LearnerModel, SkillMasteryScore       | **Vai trò**: Cốt lõi AI - lưu trạng thái thành thạo kỹ năng (ví dụ: Algebra: 0.85). <br>**Quyết định**: Tách riêng thành **LearnerModel Service** vì cần cập nhật liên tục và tính toán AI nặng. <br>**SOLID**: SRP - cách ly khỏi LearnerAggregate để thay đổi logic AI không ảnh hưởng dữ liệu cá nhân. DIP - Policy modules (Adaptive Engine) phụ thuộc vào LearnerModel Interface. <br>**Deployability**: Cho phép deploy thuật toán AI mới độc lập (FR12, US8). |
| **ContentAggregate**   | LearningContent, MetadataTag, Assessment  | **Vai trò**: Quản lý nội dung tĩnh, metadata (độ khó, kỹ năng, chủ đề) phục vụ thuật toán (FR3, FR4). <br>**Quyết định**: Tách thành **Content Management Service** - dữ liệu ổn định, ít thay đổi. <br>**SOLID**: OCP - metadata mở rộng qua tagging, không sửa schema cũ. <br>**Stability**: I ≈ 0 (rất ổn định) vì nhiều service phụ thuộc (Adaptive Engine, Feedback, Dashboard). High Availability cần thiết (AC7). |
| **AdaptivePathAggregate** | AdaptivePath, PathNode                | **Vai trò**: Lưu kết quả đường đi cá nhân hóa từ Adaptive Path Generator (FR7). <br>**Quyết định**: Có thể lưu tạm (cache) hoặc tính toán on-the-fly tùy theo Performance requirement (AC3). <br>**SOLID**: SRP - chỉ biểu diễn cấu trúc lộ trình, không chứa logic tạo lộ trình. |
| **UserManagementAggregate** | User, Role, Permission              | **Vai trò**: Quản lý xác thực, phân quyền (RBAC - FR1, FR11). <br>**Quyết định**: Tách thành **Auth Service** để tái sử dụng (có thể dùng cho nhiều hệ thống). <br>**SOLID**: SRP - chỉ quản lý identity/security. ISP - tách interface cho Authentication và Authorization. <br>**Security**: AC6 - audit logs cho mọi thay đổi quyền. |

#### B. Domain Services (Logic nghiệp vụ cốt lõi)

##### Khái niệm Domain Service
- **Domain Service**: Nơi đặt logic nghiệp vụ **không thuộc về một Entity/Aggregate cụ thể**.
- **Đặc điểm**: Stateless, phụ thuộc vào **Abstraction** (Interface), dễ test và hoán đổi.
- **Vai trò kiến trúc**: Là **Policy Modules** trong Clean Architecture - chứa quy tắc nghiệp vụ cốt lõi, phải **ổn định** (I ≈ 0).

| Tên Domain Service    | Vị trí Kiến trúc  | Phụ thuộc Chính | Vai trò & Quyết định Kiến trúc |
|-----------------------|-------------------|-----------------|--------------------------------|
| **AdaptivePathGenerator** | AI/Policy Module | LearnerModel (I), ContentMetadata (I) | **Vai trò**: Tạo lộ trình học tập cá nhân hóa dựa trên điểm mạnh/yếu (FR7, US0). <br>**Quyết định**: Đặt trong **Adaptive Engine Service** riêng để dễ deploy thuật toán mới (FR12, AC1). <br>**SOLID**: SRP - chỉ tạo lộ trình. DIP - phụ thuộc LearnerModel Interface (không phải DB cụ thể). OCP - thêm thuật toán mới (ví dụ: Reinforcement Learning) không sửa code cũ. <br>**Testability**: Mock LearnerModel để test logic independent. |
| **ScoringEngine**     | AI/Policy Module  | Assessment (I), LearnerModel (I) | **Vai trò**: Chấm điểm (auto-grading) và cập nhật SkillMasteryScore (FR5, FR6). <br>**Quyết định**: Có thể tích hợp ML model để chấm essay/coding. <br>**SOLID**: SRP - chỉ xử lý scoring logic. DIP - phụ thuộc Assessment Interface. <br>**Deployability**: Hoán đổi model chấm điểm dễ dàng (FR12, US8). <br>**Performance**: Target < 1s cho grading (AC3). |
| **FeedbackGenerator** | AI/Policy Module  | Assessment (I), ErrorType (I) | **Vai trò**: Tạo phản hồi tức thì, hints, remediation suggestions (FR6, US1). <br>**Quyết định**: Có thể tích hợp NLP để tạo giải thích tự nhiên. <br>**SOLID**: SRP - chỉ tạo feedback. ISP - tách interface HintGenerator, ExplanationGenerator, RemediationSuggester để client chỉ phụ thuộc cái cần dùng. <br>**Performance**: Hiển thị < 500ms (AC3). |

#### C. Ánh xạ Aggregate → Microservice/Component

Bảng dưới cho thấy cách Domain Model dẫn đến quyết định kiến trúc Microservices:

| Aggregate/Service     | Lý do Tách Service | Chỉ số Bất ổn (I) | ACs ưu tiên |
|-----------------------|--------------------|-------------------|-------------|
| LearnerAggregate → **Learner Service** | CRUD profile, ít thay đổi nhưng cần sẵn sàng cao | I ≈ 0.3 | AC7 (Availability) |
| LearnerModelAggregate → **LearnerModel Service** | Cập nhật liên tục, tính toán AI nặng, cần deploy riêng | I ≈ 0.6 | AC1 (Modularity), AC5 (Deployability) |
| ContentAggregate → **Content Management Service** | Dữ liệu ổn định, nhiều service phụ thuộc | I ≈ 0 | AC7 (Reliability), AC2 (Scalability) |
| AdaptivePathGenerator → **Adaptive Engine Service** | Logic AI cốt lõi, cần hoán đổi thuật toán | I ≈ 0 | AC1 (Extensibility), AC5 (Deployability) |
| UserManagementAggregate → **Auth Service** | Tái sử dụng, bảo mật cao | I ≈ 0.2 | AC6 (Security) |

**Giải thích Chỉ số I (Instability)**:
- **I = 0**: Rất ổn định (nhiều service phụ thuộc, ít thay đổi) → Content, Policy Modules
- **I → 1**: Bất ổn (ít phụ thuộc, thay đổi nhiều) → LearnerModel (cập nhật liên tục)
- **Nguyên tắc**: Policy (I≈0) không nên phụ thuộc vào Detail (I→1) → DIP
