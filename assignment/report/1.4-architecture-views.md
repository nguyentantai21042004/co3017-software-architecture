# Nhiệm vụ Chưa Hoàn Thành

## Sơ đồ 1: Sơ đồ Kiến trúc Tổng quan (C4 - Container Diagram)

### 1.1. Mục đích
Trực quan hóa quyết định Microservices của bạn. Sơ đồ này cho người đọc thấy các "hộp" (services) chính mà bạn đã định nghĩa trong file 1.3 (ví dụ: Auth Service, LearnerModel Service, Content Service, Adaptive Engine Service...) và cách chúng giao tiếp với nhau (ví dụ: qua API Gateway, qua Kafka).

### 1.2. Chiến lược
Bám sát vào bảng "Ánh xạ Aggregate → Microservice/Component" để vẽ sơ đồ.

```mermaid
c4container
    title Sơ đồ Kiến trúc Tổng quan (C4 Container - Microservices) [Dựa trên 1.3]

    ' ---- Actors (Từ 1.0) ----
    Person(learner, "Learner", "Học sinh (US0-3)")
    Person(instructor, "Instructor", "Giảng viên (US4-6)")
    Person(admin, "Admin", "Quản trị viên (US7-8)")

    ' ---- Databases & Message Queue (Từ 1.2 & 1.3) ----
    SystemDb(postgres_db, "PostgreSQL DB", "Lưu trữ chính (Users, Content, Progress)")
    SystemDb(redis_cache, "Redis Cache", "Cache LearnerModel, Paths (AC3)")
    SystemQueue(kafka, "Kafka / RabbitMQ", "Message Bus (AC2, AC7)")

    ' ---- System Boundary (ITS) ----
    System_Boundary(its, "Hệ thống Gia sư Thông minh (ITS)") {
        ' ---- Services (Ánh xạ từ 1.3) ----
        Container(gateway, "API Gateway", "Spring Cloud / Nginx", "Cổng vào chính, điều phối, xác thực")
        Container(auth, "Auth Service", "Java/Spring", "Quản lý User & RBAC (FR1, FR11) [từ UserManagementAggregate]")
        Container(learner_svc, "Learner Service", "Java/Spring", "Quản lý Profile & Tiến độ (FR2) [từ LearnerAggregate]")
        Container(content_svc, "Content Mgmt Service", "Java/Spring", "Quản lý Nội dung & Metadata (FR3, FR4) [từ ContentAggregate]")
        Container(learner_model_svc, "LearnerModel Service", "Golang", "Lưu trạng thái AI, BKT (FR7, US8) [từ LearnerModelAggregate]")
        Container(adaptive_engine, "Adaptive Engine", "Golang", "Tạo lộ trình, gợi ý (FR7, US0) [từ AdaptivePathGenerator]")
        Container(scoring_svc, "Scoring Service", "Python/Go", "Chấm điểm & Phản hồi (FR5, FR6) [từ ScoringEngine]")
        Container(feedback_svc, "Feedback Service", "Golang", "Tạo gợi ý, remediation (FR6) [từ FeedbackGenerator]")

        ' ---- Service Relationships (Sync) ----
        Rel(gateway, auth, "Xác thực (AuthN/AuthZ)", "REST/gRPC")
        Rel(gateway, learner_svc, "Profile, Progress (UC-03)")
        Rel(gateway, content_svc, "Quản lý nội dung (UC-05)")
        Rel(gateway, adaptive_engine, "Yêu cầu Lộ trình (UC-08)")
        Rel(gateway, scoring_svc, "Nộp bài (UC-09)")
        Rel(gateway, feedback_svc, "Yêu cầu gợi ý (UC-10)")

        ' ---- Internal Service-to-Service (Sync) ----
        Rel(adaptive_engine, learner_model_svc, "Đọc trạng thái (I=0.6)", "gRPC")
        Rel(adaptive_engine, content_svc, "Đọc metadata (I=0)", "gRPC")
        Rel(feedback_svc, learner_model_svc, "Đọc trạng thái yếu", "gRPC")
        Rel(feedback_svc, content_svc, "Đọc nội dung remediation", "gRPC")
    }

    ' ---- User Flows (HTTPS) ----
    Rel_Back(learner, gateway, "Sử dụng hệ thống")
    Rel_Back(instructor, gateway, "Sử dụng hệ thống")
    Rel_Back(admin, gateway, "Sử dụng hệ thống")

    ' ---- Database/Cache Flows ----
    Rel(auth, postgres_db, "Đọc/Ghi Users, Roles")
    Rel(learner_svc, postgres_db, "Đọc/Ghi Profiles")
    Rel(content_svc, postgres_db, "Đọc/Ghi Content (I=0)")
    Rel(learner_model_svc, postgres_db, "Đọc/Ghi BKT state")
    Rel(learner_model_svc, redis_cache, "Đọc/Ghi cache (AC3)")
    Rel(adaptive_engine, redis_cache, "Ghi cache lộ trình (TTL 15m) [1.3]")

    ' ---- Async Flows (Event-driven) ----
    Rel(scoring_svc, kafka, "Publish 'SubmissionCompleted'")
    Rel(learner_model_svc, kafka, "Consume 'SubmissionCompleted'")
```

## Sơ đồ 2: Sơ đồ Module (Clean Architecture Diagram)

### 2.1. Mục đích
Trực quan hóa bên trong một Microservice. Bạn đã đề cập đến Clean Architecture (hoặc Hexagonal) và cung cấp code Golang. Sơ đồ này sẽ cho thấy các lớp (Domain, Application, Infrastructure) và cách nguyên tắc DIP được áp dụng (các lớp bên ngoài phụ thuộc vào interface của lớp bên trong).

### 2.2. Chiến lược
Chọn một service quan trọng để vẽ, ví dụ: Adaptive Engine Service và minh họa AdaptivePathGenerator (Domain Service) của bạn nằm ở đâu.

```mermaid
graph TD
    title Sơ đồ Module (Clean Architecture) - Service: Adaptive Engine [Dựa trên 1.3]

    subgraph Lớp Infrastructure (Vành ngoài)
        direction LR
        A[gRPC/REST Controllers<br>(Endpoint: /generate-path)]
        B[LearnerModelRepoImpl<br>(Client: Postgres/Redis)]
        C[ContentRepoImpl<br>(Client: Postgres)]
    end

    subgraph Lớp Application (Use Cases)
        direction LR
        D[AdaptivePathAppService<br>(Xử lý Use Case UC-08)]
    end

    subgraph "Lớp Domain (Lõi nghiệp vụ - I=0)"
        direction LR
        E[Entity: AdaptivePath<br>Entity: PathNode]
        F[<b>Domain Service:<br>AdaptivePathGenerator</b><br>(Chứa logic/thuật toán FR7)]
        G[<b>Interface:<br>LearnerModelRepository</b>]
        H[<b>Interface:<br>ContentRepository</b>]
    end

    ' --- Mũi tên thể hiện Sự phụ thuộc (Dependency Rule) --- '
    ' --- Luôn hướng vào trong (DIP) --- '
    
    ' Lớp Infrastructure phụ thuộc vào Lớp Application
    A -- "Gọi (invokes)" --> D

    ' Lớp Infrastructure (Implementation) phụ thuộc vào Lớp Domain (Interface)
    B -- "<b>Implement (hiện thực hóa)</b>" --> G
    C -- "<b>Implement (hiện thực hóa)</b>" --> H

    ' Lớp Application phụ thuộc vào Lớp Domain (Interfaces & Services)
    D -- "Sử dụng (uses)" --> F
    D -- "Phụ thuộc (depends on)" --> G
    D -- "Phụ thuộc (depends on)" --> H

    ' Lớp Domain (Domain Service) phụ thuộc vào Interface (cùng lớp)
    F -- "<b>Phụ thuộc (depends on)</b>" --> G
    F -- "<b>Phụ thuộc (depends on)</b>" --> H

    ' Lớp Domain (Domain Service) tạo ra Entities
    F -- "Tạo (creates)" --> E

    ' Styling: Tô đậm các thành phần cốt lõi
    style F fill:#fdf,stroke:#333,stroke-width:2px
    style G fill:#dfd,stroke:#333,stroke-width:2px
    style H fill:#dfd,stroke:#333,stroke-width:2px
```

## Sơ đồ 3: Sơ đồ Tuần tự (Sequence Diagram)

### 3.1. Mục đích
Minh họa một luồng nghiệp vụ quan trọng chạy qua nhiều service.

### 3.2. Chiến lược
Chọn một Use Case quan trọng từ danh sách của bạn (file 1.3). Tôi đề xuất bạn chọn UC-08 (Bắt đầu/Tiếp tục Học tập Thích ứng).

```mermaid
sequenceDiagram
    title Sơ đồ Tuần tự (Sequence Diagram) - UC-08: Bắt đầu Học tập Thích ứng

    actor Learner
    participant Gateway as API Gateway
    participant Engine as Adaptive Engine (Golang)
    participant LearnerModel as LearnerModel Svc (Golang)
    participant Content as Content Mgmt Svc (Java)
    participant Cache as Redis Cache (AC3)

    Learner->>Gateway: 1. Yêu cầu bài học tiếp theo
    Gateway->>Engine: 2. GeneratePath(learnerId)
    
    Engine->>Cache: 3. Đọc cache lộ trình (Key: path:learnerId)
    
    alt Cache Miss (Cache không có hoặc hết hạn 15p)
        Cache-->>Engine: 4. (null)
        
        ' --- Bắt đầu logic của AdaptivePathGenerator --- '
        Engine->>LearnerModel: 5. Đọc LearnerModel (GetSkillMastery)
        LearnerModel-->>Engine: 6. Trả về SkillMasteryScore (ví dụ: Algebra: 0.3)
        
        Engine->>Content: 7. Đọc ContentMetadata (cho kỹ năng yếu)
        Content-->>Engine: 8. Trả về Metadata (bài tập, độ khó)
        
        activate Engine
        note right of Engine: 9. Áp dụng thuật toán (AdaptivePathGenerator)<br/>Tạo lộ trình (AdaptivePath)
        deactivate Engine
        ' --- Kết thúc logic của AdaptivePathGenerator --- '
        
        Engine->>Cache: 10. Lưu kết quả vào cache (TTL=15min)
        Cache-->>Engine: 11. (OK)
        
        Engine-->>Gateway: 12. Trả về AdaptivePath (mới)
    else Cache Hit
        Cache-->>Engine: 4. Trả về AdaptivePath (từ cache)
        Engine-->>Gateway: 12. Trả về AdaptivePath (từ cache)
    end
    
    Gateway-->>Learner: 13. Hiển thị nội dung bài học
```

## Sơ đồ 4: Sơ đồ Triển khai (Deployment Diagram)

### 4.1. Mục đích
Trực quan hóa yêu cầu phi chức năng AC2 (Scalability) và AC1 (Modularity).

### 4.2. Chiến lược
Vẽ một sơ đồ đơn giản thể hiện bạn dự định triển khai các service này như thế nào. (Ví dụ: Sử dụng Kubernetes Cluster, với các Pods cho từng service, kết nối với Kafka và cơ sở dữ liệu (Postgres/Redis) như bạn đã đề cập).

```mermaid
graph TD
    title Sơ đồ Triển khai (Deployment Diagram) [Tuân thủ AC1, AC2, AC8]

    User[Learner/Instructor] --> LB[Cloud Load Balancer (HTTPS)]
    
    subgraph "VPC (Mạng riêng ảo)"
        subgraph "Kubernetes Cluster (GKE/EKS/AKS)" [AC2: Scalability]
            direction LR
            LB --> Ingress[K8s Ingress Gateway]

            subgraph "Node 1"
                P1[Pod: Adaptive Engine (Go)]
                P2[Pod: LearnerModel Svc (Go)]
                P3[Pod: Auth Service (Java)]
            end
            
            subgraph "Node 2"
                P4[Pod: Adaptive Engine (Go) - Replica]
                P5[Pod: Content Svc (Java)]
                P6[Pod: Scoring Svc (Python)]
            end
            
            subgraph "Node N (Auto-scaled HPA)"
                P7[Pod: Adaptive Engine (Go) - Replica N]
                P8[Pod: LearnerModel Svc (Go) - Replica N]
            end

            ' Service Discovery '
            Ingress -- "service: adaptive-engine" --> P1
            Ingress -- "service: adaptive-engine" --> P4
            Ingress -- "service: adaptive-engine" --> P7
            Ingress -- "service: content-svc" --> P5
            P1 -- "service: learner-model" --> P2
            P1 -- "service: learner-model" --> P8
            
            ' Observability (AC8) '
            P1 --> O1[Logs/Metrics (ELK/Prometheus/Jaeger)]
            P2 --> O1
            P5 --> O1
        end

        subgraph "Managed Services (Cloud Provider)"
            M1[Managed PostgreSQL (Cloud SQL/RDS)]
            M2[Managed Redis (MemoryStore/ElastiCache)]
            M3[Managed Kafka (Confluent/MSK) [AC2]]
        end
    end

    ' --- Kết nối từ Pods ra bên ngoài Cluster --- '
    P2 -- "Đọc/Ghi state" --> M1
    P8 -- "Đọc/Ghi state" --> M1
    P2 -- "Đọc/Ghi cache" --> M2
    P3 -- "Đọc/Ghi users" --> M1
    P5 -- "Đọc/Ghi content" --> M1
    P6 -- "Publish event" --> M3
    P2 -- "Consume event" --> M3
```