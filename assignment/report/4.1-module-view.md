# GÃ³c NhÃ¬n Module (Module Views)

## Má»¥c TiÃªu

TrÃ¬nh bÃ y cáº¥u trÃºc logic cá»§a mÃ£ nguá»“n bÃªn trong má»™t **Architecture Quantum** Ä‘iá»ƒn hÃ¬nh, Ä‘áº£m báº£o tÃ­nh **Modularity** vÃ  **Testability** cao.

---

## 1. SÆ¡ Äá»“ Cáº¥u TrÃºc Lá»›p/Module Ná»™i Bá»™

### 1.1. Internal Clean Architecture Diagram

ChÃºng ta sáº½ Ã¡p dá»¥ng **Clean Architecture** (hoáº·c Hexagonal Architecture) bÃªn trong **Adaptive Engine Service** Ä‘á»ƒ phÃ¢n tÃ¡ch:
- **Logic AI/Nghiá»‡p vá»¥ (Policy)** khá»i
- **CÆ¡ sá»Ÿ háº¡ táº§ng (Details)**

### 1.2. PhÃ¢n TÃ­ch Chi Tiáº¿t CÃ¡c Lá»›p (Layers)

Kiáº¿n trÃºc nÃ y tuÃ¢n thá»§ **Dependency Inversion Principle (DIP)**, trong Ä‘Ã³ cÃ¡c lá»›p bÃªn ngoÃ i (Infrastructure) luÃ´n phá»¥ thuá»™c vÃ o cÃ¡c lá»›p bÃªn trong (Domain/Application).

| **Lá»›p (Layer)** | **Vai TrÃ²** | **Component ChÃ­nh trong Adaptive Engine** | **Cá»§ng Cá»‘ ACs/SOLID** |
|-----------------|-------------|------------------------------------------|----------------------|
| **1. Domain<br>(Entities & Core Rules)** | Chá»©a cÃ¡c quy táº¯c nghiá»‡p vá»¥ cá»‘t lÃµi, Ä‘á»™c láº­p vá»›i báº¥t ká»³ á»©ng dá»¥ng nÃ o. ÄÃ¢y lÃ  táº§ng á»•n Ä‘á»‹nh nháº¥t. | - `LearnerModel` (Entity)<br>- `ContentMetadata` (Entity)<br>- `AdaptivePath` (Entity) | **SRP** (Single Responsibility Principle):<br>Chá»‰ mÃ´ táº£ dá»¯ liá»‡u vÃ  quy táº¯c nghiá»‡p vá»¥. |
| **2. Application<br>(Use Cases/Interactors)** | Chá»©a cÃ¡c quy táº¯c nghiá»‡p vá»¥ cá»¥ thá»ƒ cá»§a á»©ng dá»¥ng (Policy Modules). Äiá»u phá»‘i luá»“ng dá»¯ liá»‡u Ä‘áº¿n vÃ  Ä‘i tá»« Domain. | - `AdaptivePathGenerator` (Use Case/Policy): Chá»©a thuáº­t toÃ¡n AI quyáº¿t Ä‘á»‹nh lá»™ trÃ¬nh tá»‘i Æ°u (FR7)<br>- `LearnerModelRepository` Interface: Äá»‹nh nghÄ©a há»£p Ä‘á»“ng cho viá»‡c láº¥y/lÆ°u trá»¯ LearnerModel | **DIP** (Dependency Inversion Principle):<br>Táº§ng nÃ y chá»‰ phá»¥ thuá»™c vÃ o Interfaces (vÃ­ dá»¥: `LearnerModelRepository` Interface), khÃ´ng pháº£i DB cá»¥ thá»ƒ.<br>â†’ Code ráº¥t á»•n Ä‘á»‹nh (Iâ‰ˆ0) |
| **3. Interface Adapters** | Chuyá»ƒn Ä‘á»•i dá»¯ liá»‡u giá»¯a cÃ¡c Ä‘á»‹nh dáº¡ng bÃªn ngoÃ i (Web Request, DB Record) vÃ  cÃ¡c Ä‘á»‹nh dáº¡ng bÃªn trong (Domain Entities). | - `AdaptiveController`: Xá»­ lÃ½ API Request (REST)<br>- `LearnerModelRepositoryImpl` (Concrete Class): Lá»›p triá»ƒn khai Repository Interface, káº¿t ná»‘i vá»›i Database | **Testability (AC4):**<br>GiÃºp cÃ´ láº­p logic nghiá»‡p vá»¥ khá»i táº§ng giao diá»‡n/I/O, cho phÃ©p Mock DB khi kiá»ƒm thá»­ `AdaptivePathGenerator` |
| **4. Infrastructure** | Chá»©a táº¥t cáº£ cÃ¡c chi tiáº¿t triá»ƒn khai bÃªn ngoÃ i (DB, Web Framework, Message Queue). | - MongoDB/PostgreSQL Driver<br>- Kafka Producer/Consumer<br>- Server Framework (Spring Boot, FastAPI) | **OCP** (Open/Closed Principle):<br>Náº¿u Ä‘á»•i DB tá»« MongoDB sang PostgreSQL, chá»‰ cáº§n thay Ä‘á»•i/má»Ÿ rá»™ng lá»›p nÃ y mÃ  khÃ´ng cáº§n sá»­a táº§ng Application Core |

### 1.3. SÆ¡ Äá»“ Clean Architecture (Mermaid)

```mermaid
flowchart TB

subgraph Infrastructure
  DB[(PostgreSQL / MongoDB)]
  MQ((Kafka))
  WebFW([FastAPI / Spring Boot])
end

subgraph InterfaceAdapters["Interface Adapters"]
  Controller[AdaptiveController]
  RepoImpl[LearnerModelRepositoryImpl]
end

subgraph Application["Application Layer"]
  PathGen[AdaptivePathGenerator<br/>Use Case]
  RepoIF[LearnerModelRepository<br/>Interface]
end

subgraph Domain["Domain Layer"]
  LearnerModel[(LearnerModel<br/>Entity)]
  ContentMetadata[(ContentMetadata<br/>Entity)]
  AdaptivePath[(AdaptivePath<br/>Entity)]
end

%% Luá»“ng phá»¥ thuá»™c
WebFW --> Controller
Controller --> PathGen
PathGen --> RepoIF
RepoImpl --> DB
RepoImpl --> MQ
RepoIF -.implements.-> RepoImpl
PathGen --> LearnerModel
LearnerModel --> ContentMetadata
AdaptivePath --> LearnerModel

%% Styling
classDef domainStyle fill:#e1f5e1,stroke:#4caf50,stroke-width:2px
classDef appStyle fill:#e3f2fd,stroke:#2196f3,stroke-width:2px
classDef adapterStyle fill:#fff3e0,stroke:#ff9800,stroke-width:2px
classDef infraStyle fill:#fce4ec,stroke:#e91e63,stroke-width:2px

class LearnerModel,ContentMetadata,AdaptivePath domainStyle
class PathGen,RepoIF appStyle
class Controller,RepoImpl adapterStyle
class DB,MQ,WebFW infraStyle
```

**ğŸ’¡ NguyÃªn táº¯c DIP (Dependency Inversion):**
- Application Layer chá»‰ phá»¥ thuá»™c vÃ o **Interfaces** (Abstraction)
- KhÃ´ng phá»¥ thuá»™c vÃ o **Implementation** (Concretion)
- Dependencies luÃ´n hÆ°á»›ng vÃ o trong (tá»« ngoÃ i â†’ trong)

---

## 2. LÃ½ Giáº£i Vá» Phá»¥ Thuá»™c Module vÃ  TÃ­nh á»”n Äá»‹nh

Viá»‡c Ã¡p dá»¥ng Clean Architecture trá»±c tiáº¿p cá»§ng cá»‘ hai Architecture Characteristics quan trá»ng nháº¥t:

### 2.1. Cá»§ng Cá»‘ Testability (AC4)

#### **TÃ¡ch biá»‡t Policy khá»i Detail**

- **`AdaptivePathGenerator`** (Policy - Logic AI):
  - Náº±m á»Ÿ táº§ng Application (bÃªn trong)
  - TÃ¡ch biá»‡t hoÃ n toÃ n khá»i `LearnerModelRepositoryImpl` (Detail - káº¿t ná»‘i DB)

#### **Thá»±c thi Testing**

Khi kiá»ƒm thá»­ `AdaptivePathGenerator`:
1. Chá»‰ cáº§n **Mock** (giáº£ láº­p) `LearnerModelRepository` Interface
2. Unit Test táº­p trung vÃ o **logic thuáº­t toÃ¡n**
3. KhÃ´ng phá»¥ thuá»™c vÃ o tráº¡ng thÃ¡i cá»§a DB hay Framework

**Lá»£i Ã­ch:**
- âœ… Test nhanh (khÃ´ng cáº§n khá»Ÿi Ä‘á»™ng DB)
- âœ… Test Ä‘á»™c láº­p (khÃ´ng bá»‹ áº£nh hÆ°á»Ÿng bá»Ÿi infrastructure)
- âœ… Test coverage cao (dá»… dÃ ng test edge cases)

### 2.2. Äáº£m Báº£o TÃ­nh á»”n Äá»‹nh (Modularity - AC1)

#### **Instability Index (I)**

**CÃ´ng thá»©c:** 

$$I = \frac{C_e}{C_e + C_a}$$

Trong Ä‘Ã³:
- **Câ‚‘ (Efferent Coupling):** Sá»‘ dependencies Ä‘i ra (outgoing)
- **Câ‚ (Afferent Coupling):** Sá»‘ dependencies Ä‘i vÃ o (incoming)
- **I âˆˆ [0, 1]:** 
  - I = 0 â†’ Ráº¥t á»•n Ä‘á»‹nh (nhiá»u module phá»¥ thuá»™c vÃ o nÃ³)
  - I = 1 â†’ Ráº¥t báº¥t á»•n (phá»¥ thuá»™c nhiá»u vÃ o module khÃ¡c)

#### **PhÃ¢n TÃ­ch CÃ¡c Layer**

| **Layer** | **Câ‚‘** | **Câ‚** | **I** | **Giáº£i ThÃ­ch** |
|-----------|--------|--------|-------|----------------|
| **Application Layer**<br>(`AdaptivePathGenerator`) | Tháº¥p<br>(chá»‰ phá»¥ thuá»™c Interfaces) | Cao<br>(nhiá»u lá»›p bÃªn ngoÃ i phá»¥ thuá»™c vÃ o nÃ³) | **I â‰ˆ 0**<br>(Ráº¥t á»”n Ä‘á»‹nh) | Logic AI cá»‘t lÃµi Ä‘Æ°á»£c **báº£o vá»‡ khá»i sá»± thay Ä‘á»•i**.<br>Khi infrastructure thay Ä‘á»•i, logic AI khÃ´ng bá»‹ áº£nh hÆ°á»Ÿng. |
| **Infrastructure Layer**<br>(DB Driver) | Cao<br>(phá»¥ thuá»™c vÃ o thÆ° viá»‡n bÃªn ngoÃ i) | Tháº¥p<br>(Ã­t module phá»¥ thuá»™c vÃ o nÃ³) | **I â‰ˆ 1**<br>(Ráº¥t Báº¥t á»•n) | Äiá»u nÃ y lÃ  **mong muá»‘n**.<br>Chi tiáº¿t triá»ƒn khai (DB, Framework) Ä‘Æ°á»£c mong Ä‘á»£i sáº½ thay Ä‘á»•i thÆ°á»ng xuyÃªn. |

#### **Minh Há»a**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Application Layer (AdaptivePathGenerator)      â”‚
â”‚  â€¢ Câ‚ = 5 (Controller, API, Tests... phá»¥ thuá»™c) â”‚
â”‚  â€¢ Câ‚‘ = 1 (chá»‰ phá»¥ thuá»™c Interface)              â”‚
â”‚  â€¢ I = 1/(1+5) = 0.17 â‰ˆ 0 (Ráº¤T á»”N Äá»ŠNH)        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â†‘
                    â”‚ (depends on Interface)
                    â”‚
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Infrastructure Layer (RepositoryImpl)           â”‚
â”‚  â€¢ Câ‚ = 1 (chá»‰ Interface Adapter phá»¥ thuá»™c)     â”‚
â”‚  â€¢ Câ‚‘ = 5 (DB, ORM, Config, Logger...)          â”‚
â”‚  â€¢ I = 5/(5+1) = 0.83 â‰ˆ 1 (Ráº¤T Báº¤T á»”N)         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.3. Ãp Dá»¥ng SOLID Principles

| **Principle** | **Ãp Dá»¥ng Trong Clean Architecture** | **Lá»£i Ãch** |
|---------------|--------------------------------------|-------------|
| **SRP**<br>(Single Responsibility) | Má»—i layer cÃ³ má»™t trÃ¡ch nhiá»‡m duy nháº¥t:<br>- Domain: Business rules<br>- Application: Use cases<br>- Adapters: Data conversion | Dá»… báº£o trÃ¬, dá»… hiá»ƒu |
| **OCP**<br>(Open/Closed) | Má»Ÿ rá»™ng báº±ng cÃ¡ch thÃªm Adapter má»›i,<br>khÃ´ng sá»­a Application/Domain | Giáº£m rá»§i ro khi thay Ä‘á»•i |
| **LSP**<br>(Liskov Substitution) | Má»i implementation cá»§a Repository<br>Ä‘á»u thay tháº¿ Ä‘Æ°á»£c cho Interface | Linh hoáº¡t trong testing |
| **ISP**<br>(Interface Segregation) | Interfaces nhá», cá»¥ thá»ƒ<br>(vÃ­ dá»¥: `LearnerModelRepository`) | TrÃ¡nh phá»¥ thuá»™c khÃ´ng cáº§n thiáº¿t |
| **DIP**<br>(Dependency Inversion) | **Application phá»¥ thuá»™c Interface,<br>khÃ´ng phá»¥ thuá»™c Implementation** | **TÃ­nh á»•n Ä‘á»‹nh cao (Iâ‰ˆ0)** |

---

## 3. Káº¿t Luáº­n

### 3.1. TÃ³m Táº¯t

**GÃ³c nhÃ¬n Module** nÃ y Ä‘Ã£ thiáº¿t láº­p má»™t cáº¥u trÃºc lá»›p vá»¯ng cháº¯c, nÆ¡i cÃ¡c nguyÃªn táº¯c **SOLID** Ä‘Æ°á»£c thá»±c thi Ä‘á»ƒ Ä‘áº£m báº£o:

1. âœ… **Testability (AC4):** 
   - Logic nghiá»‡p vá»¥ tÃ¡ch biá»‡t khá»i infrastructure
   - Dá»… dÃ ng mock vÃ  test
   - Test coverage cao

2. âœ… **Modularity (AC1):**
   - Application Layer cÃ³ Iâ‰ˆ0 (ráº¥t á»•n Ä‘á»‹nh)
   - Infrastructure Layer cÃ³ Iâ‰ˆ1 (dá»… thay Ä‘á»•i)
   - PhÃ¢n tÃ¡ch rÃµ rÃ ng giá»¯a Policy vÃ  Detail

3. âœ… **Maintainability (AC7):**
   - Má»—i layer cÃ³ trÃ¡ch nhiá»‡m rÃµ rÃ ng
   - Thay Ä‘á»•i infrastructure khÃ´ng áº£nh hÆ°á»Ÿng logic
   - TuÃ¢n thá»§ OCP vÃ  DIP

### 3.2. Ãp Dá»¥ng Cho CÃ¡c Services KhÃ¡c

Cáº¥u trÃºc Clean Architecture nÃ y Ä‘Æ°á»£c Ã¡p dá»¥ng **nháº¥t quÃ¡n** cho táº¥t cáº£ cÃ¡c microservices trong ITS:

- **Learner Model Service**
- **Assessment Engine Service**
- **Content Delivery Service**
- **AI Reasoning Service**

â†’ Äáº£m báº£o **consistency** vÃ  **quality** xuyÃªn suá»‘t toÃ n bá»™ há»‡ thá»‘ng.

---

**TÃ i liá»‡u tham kháº£o:**
- Clean Architecture (Robert C. Martin)
- Fundamentals of Software Architecture (Mark Richards, Neal Ford)
- Domain-Driven Design (Eric Evans)
