# GÃ³c NhÃ¬n Component vÃ  Connector (Component and Connector Views)

## Má»¥c TiÃªu

GÃ³c nhÃ¬n nÃ y táº­p trung vÃ o:
- **Architecture Quantum:** CÃ¡c Ä‘Æ¡n vá»‹ triá»ƒn khai Ä‘á»™c láº­p
- **Runtime Interactions:** CÃ¡ch chÃºng tÆ°Æ¡ng tÃ¡c trong thá»i gian cháº¡y
- **Communication Patterns:** Äá»“ng bá»™ (REST) vÃ  báº¥t Ä‘á»“ng bá»™ (Event-Driven)

ÄÃ¢y lÃ  nÆ¡i kiáº¿n trÃºc **Microservices + Event-Driven** cá»§a ITS Ä‘Æ°á»£c trá»±c quan hÃ³a.

---

## 1. SÆ¡ Äá»“ Service (Container Diagram - C4 Model)

### 1.1. MÃ´ Táº£ Tá»•ng Quan

SÆ¡ Ä‘á»“ nÃ y thá»ƒ hiá»‡n **ranh giá»›i váº­t lÃ½** cá»§a cÃ¡c Microservices:
- Má»—i **Service (Container)** lÃ  má»™t Ä‘Æ¡n vá»‹ triá»ƒn khai Ä‘á»™c láº­p
- Giao tiáº¿p qua máº¡ng: **REST** (Ä‘á»“ng bá»™) hoáº·c **Messaging** (báº¥t Ä‘á»“ng bá»™)
- TuÃ¢n thá»§ nguyÃªn táº¯c **Single Responsibility** á»Ÿ cáº¥p service

### 1.2. PhÃ¢n TÃ­ch & Vai TrÃ² Cá»§a CÃ¡c Service

| **Service (Container)** | **Vai TrÃ² ChÃ­nh** | **Giao Tiáº¿p ChÃ­nh** | **Cá»§ng Cá»‘ ACs** |
|-------------------------|-------------------|---------------------|-----------------|
| **API Gateway** | Äiá»ƒm vÃ o duy nháº¥t (Single Entry Point).<br>Xá»­ lÃ½:<br>- Authentication (XÃ¡c thá»±c)<br>- Routing (Äá»‹nh tuyáº¿n)<br>- Rate limiting | REST (Ä‘á»“ng bá»™) | **AC6:** Security<br>**AC3:** Performance |
| **User Management Service** | Quáº£n lÃ½ tÃ i khoáº£n:<br>- Learner/Instructor/Admin<br>- RBAC (Role-Based Access Control)<br>- Session management | REST API<br>SQL Database | **AC6:** Security |
| **Content Service** | Quáº£n lÃ½ ná»™i dung há»c táº­p:<br>- Learning materials (FR3)<br>- Metadata (FR5)<br>- Content versioning<br>**Dá»¯ liá»‡u ráº¥t á»•n Ä‘á»‹nh (Iâ‰ˆ0)** | REST API<br>SQL Database | **AC1:** Modularity<br>**AC7:** Maintainability |
| **Adaptive Engine Service** | **Policy Module Cá»‘t lÃµi**<br>- `AdaptivePathGenerator` (FR7)<br>- Quyáº¿t Ä‘á»‹nh lá»™ trÃ¬nh há»c táº­p<br>- AI/ML algorithms | **Synchronous:** REST (vá»›i Gateway)<br>**Asynchronous:** Events (vá»›i Learner Model) | **AC1:** Modularity<br>**AC2:** Scalability |
| **Scoring/Feedback Service** | Xá»­ lÃ½ Ä‘Ã¡nh giÃ¡:<br>- Auto-grading (FR6)<br>- Instant feedback<br>- Hint generation<br>**Target: â‰¤500ms response** | **Synchronous:** REST (vá»›i Gateway)<br>**Asynchronous:** Events (publish scores) | **AC3:** Performance<br>**AC4:** Testability |
| **Learner Model Service** | Quáº£n lÃ½ learner state:<br>- `LearnerModel` entity<br>- `SkillMasteryScore` (FR2)<br>- LiÃªn tá»¥c cáº­p nháº­t tá»« Events | **Asynchronous:** Event-Driven<br>NoSQL Database | **AC2:** Scalability<br>**AC1:** Modularity |
| **Message Broker (Kafka)** | Event distribution:<br>- `AnswerSubmittedEvent`<br>- `ScoreUpdatedEvent`<br>- `PathUpdatedEvent`<br>**Decoupling services** | Messaging<br>(báº¥t Ä‘á»“ng bá»™) | **AC2:** Scalability<br>**AC1:** Modularity |

### 1.3. SÆ¡ Äá»“ Container (Mermaid)

```mermaid
flowchart TB

subgraph User["ğŸ‘¤ Users"]
    Browser[Web / Mobile Client]
end

Browser -->|HTTPS POST /api| APIGateway

subgraph APIGateway["ğŸŒ API Gateway"]
    GW[Auth + Routing Layer<br/>JWT Validation<br/>Rate Limiting]
end

GW -->|REST| UserService
GW -->|REST| ContentService
GW -->|REST| AdaptiveEngine
GW -->|REST| ScoringService

subgraph UserService["ğŸ‘¥ User Management Service"]
    UserLogic[User & Auth Logic]
    DBU[(PostgreSQL<br/>Users & Roles)]
end
UserLogic --> DBU

subgraph ContentService["ğŸ“š Content Service"]
    ContentLogic[Content Management]
    DBC[(PostgreSQL<br/>Learning Materials)]
end
ContentLogic --> DBC

subgraph AdaptiveEngine["ğŸ§  Adaptive Engine Service"]
    Policy[AdaptivePathGenerator<br/>AI Policy Module]
end
AdaptiveEngine -->|Publish Events| Kafka

subgraph ScoringService["ğŸ Scoring / Feedback Service"]
    Logic[ScoreCalculator<br/>HintGenerator]
end
ScoringService -->|Publish Events| Kafka
ScoringService -.Query Metadata.-> ContentService

subgraph LearnerModel["ğŸ“Š Learner Model Service"]
    ModelLogic[Model Update Logic]
    ModelDB[(MongoDB<br/>Learner Models)]
end
ModelLogic --> ModelDB
Kafka -->|Consume Events| LearnerModel

subgraph Kafka["ğŸ’¬ Message Broker (Kafka)"]
    Topic1[AnswerSubmittedEvent]
    Topic2[ScoreUpdatedEvent]
    Topic3[PathUpdatedEvent]
end

%% Styling
classDef gateway fill:#ff9800,stroke:#e65100,stroke-width:3px,color:#fff
classDef service fill:#2196f3,stroke:#0d47a1,stroke-width:2px,color:#fff
classDef db fill:#4caf50,stroke:#1b5e20,stroke-width:2px,color:#fff
classDef broker fill:#9c27b0,stroke:#4a148c,stroke-width:2px,color:#fff
classDef user fill:#607d8b,stroke:#263238,stroke-width:2px,color:#fff

class GW gateway
class UserLogic,ContentLogic,Policy,Logic,ModelLogic service
class DBU,DBC,ModelDB db
class Topic1,Topic2,Topic3 broker
class Browser user
```

**ğŸ”‘ ChÃº giáº£i:**
- **Solid arrows (â†’):** Synchronous communication (REST/HTTP)
- **Dotted arrows (-.->):** Query/Read operations
- **Bold arrows:** Asynchronous communication (Events via Kafka)

**ğŸ’¡ Design Decisions:**

| **Pattern** | **Rationale** | **AC Supported** |
|-------------|---------------|------------------|
| **API Gateway** | Single entry point, centralized auth, simplifies client | Security (AC6), Performance (AC3) |
| **Event-Driven (Kafka)** | Decouple services, async processing, better scalability | Scalability (AC2), Modularity (AC1) |
| **Separate Databases** | Database per service pattern, independent scaling | Modularity (AC1), Scalability (AC2) |
| **REST for Sync** | Simple, stateless, well-understood | Simplicity, Interoperability |

---

## 2. SÆ¡ Äá»“ TrÃ¬nh Tá»± (Sequence Diagram)

### 2.1. Use Case: UC-L-02 - Xá»­ LÃ½ Pháº£n Há»“i BÃ i Táº­p

**Context:** ÄÃ¢y lÃ  use case cá»‘t lÃµi Ä‘Ã²i há»i **Performance cao (â‰¤500ms)** Ä‘á»ƒ Ä‘áº£m báº£o tráº£i nghiá»‡m ngÆ°á»i dÃ¹ng tá»‘t.

**Critical Path:** Cháº¥m Ä‘iá»ƒm vÃ  tráº£ vá» feedback ngay láº­p tá»©c

### 2.2. Luá»“ng CÆ¡ Báº£n (Critical Path)

| **STT** | **BÆ°á»›c** | **Chi Tiáº¿t Phá»‘i Há»£p Giá»¯a Services** | **Giao Tiáº¿p & Má»¥c ÄÃ­ch** |
|---------|----------|-------------------------------------|--------------------------|
| **1** | Submit Answer | Learner gá»­i cÃ¢u tráº£ lá»i qua Web/Mobile Client | `POST /api/assessments/{id}/submit`<br>**HTTP** (Ä‘á»“ng bá»™) |
| **2** | Route Request | API Gateway xÃ¡c thá»±c JWT vÃ  Ä‘á»‹nh tuyáº¿n Ä‘áº¿n Scoring Service | **HTTP Routing** (Ä‘á»“ng bá»™)<br>Latency: ~10ms |
| **3** | Fetch Assessment Metadata | Scoring Service láº¥y thÃ´ng tin bÃ i táº­p tá»« Content Service | `GET /api/content/{contentId}`<br>**HTTP** (Ä‘á»“ng bá»™)<br>**CÃ³ thá»ƒ cache** |
| **4** | Calculate Score & Generate Hint | Scoring Service xá»­ lÃ½ logic:<br>- Auto-grading<br>- Hint generation | **Internal Logic** (AC3: Performance)<br>**Pháº§n nÃ y pháº£i cá»±c nhanh** |
| **5** | âœ… Return Real-Time Feedback | Scoring Service tráº£ vá» káº¿t quáº£ cho Learner | **HTTP Response** (Ä‘á»“ng bá»™)<br>**Target: â‰¤500ms total** |
| **6** | Publish Event (Async) | Scoring Service táº¡o `AnswerSubmittedEvent` | **Kafka Publish** (báº¥t Ä‘á»“ng bá»™)<br>**KhÃ´ng block response** |
| **7** | Update Learner Model (Background) | Learner Model Service consume event vÃ  cáº­p nháº­t `SkillMasteryScore` | **Kafka Consumer** (báº¥t Ä‘á»“ng bá»™)<br>**Eventual Consistency** |

### 2.3. Sequence Diagram (Mermaid)

```mermaid
sequenceDiagram
    participant L as ğŸ‘¤ Learner
    participant GW as ğŸŒ API Gateway
    participant SS as ğŸ Scoring Service
    participant CS as ğŸ“š Content Service
    participant K as ğŸ’¬ Kafka
    participant LM as ğŸ“Š Learner Model Service

    Note over L,LM: Critical Path (â‰¤500ms)
    
    L->>+GW: POST /api/assessments/{id}/submit<br/>{answer: "..."}
    Note right of GW: JWT Validation<br/>~5ms
    
    GW->>+SS: Forward request<br/>(authenticated)
    Note right of SS: Start timer
    
    SS->>+CS: GET /api/content/{contentId}<br/>(metadata)
    Note right of CS: Cache hit: ~10ms<br/>Cache miss: ~50ms
    CS-->>-SS: Return assessment rules
    
    Note over SS: Calculate Score<br/>Generate Hint<br/>âš¡ Core Logic: ~100ms
    
    SS-->>-GW: 200 OK<br/>{score: 85, hint: "..."}
    Note right of SS: Total: ~200ms âœ…
    GW-->>-L: Return feedback
    
    Note over L,LM: Background Processing (Async)
    
    SS->>K: Publish AnswerSubmittedEvent<br/>{learnerId, score, ...}
    Note right of K: Non-blocking<br/>Fire-and-forget
    
    K->>+LM: Consume event
    Note right of LM: Update SkillMasteryScore<br/>Recalculate knowledge state
    LM->>LM: Update LearnerModel
    Note over LM: Eventual Consistency<br/>~1-2 seconds
    LM-->>-K: Ack
```

**ğŸ¯ Performance Breakdown:**

| **Phase** | **Time Budget** | **Optimization Strategy** |
|-----------|-----------------|---------------------------|
| Gateway Routing | ~10ms | In-memory JWT validation, connection pooling |
| Fetch Metadata | ~10-50ms | **Redis caching** for frequently accessed content |
| Score Calculation | ~100ms | Optimized algorithms, pre-compiled rules |
| Response Marshalling | ~10ms | Efficient JSON serialization |
| **Total (Synchronous)** | **â‰¤200ms** âœ… | **Well under 500ms target** |
| Event Publishing | ~5ms | Fire-and-forget, non-blocking |
| Model Update (Async) | ~1-2s | Background processing, eventual consistency |

---

## 3. PhÃ¢n TÃ­ch Giao Tiáº¿p Patterns

### 3.1. Synchronous Communication (REST)

**Khi nÃ o sá»­ dá»¥ng:**
- âœ… Cáº§n response ngay láº­p tá»©c (real-time feedback)
- âœ… Client cáº§n biáº¿t káº¿t quáº£ Ä‘á»ƒ tiáº¿p tá»¥c
- âœ… Simple request-response pattern

**Trong ITS:**
- API Gateway â†” All Services
- Scoring Service â†” Content Service (fetch metadata)

**Trade-offs:**
- âœ… **Pros:** Simple, immediate feedback, easy debugging
- âš ï¸ **Cons:** Tight coupling, cascade failures, latency accumulation

**Mitigation:**
- Circuit breaker pattern
- Timeouts vÃ  retries
- Caching (Redis)

### 3.2. Asynchronous Communication (Events)

**Khi nÃ o sá»­ dá»¥ng:**
- âœ… KhÃ´ng cáº§n response ngay láº­p tá»©c
- âœ… Cáº§n decouple services
- âœ… Fan-out pattern (1 event â†’ nhiá»u consumers)

**Trong ITS:**
- Scoring Service â†’ Kafka â†’ Learner Model Service
- Adaptive Engine â†’ Kafka â†’ Multiple services

**Trade-offs:**
- âœ… **Pros:** Decoupling, scalability, resilience
- âš ï¸ **Cons:** Eventual consistency, complexity, debugging harder

**Mitigation:**
- Event schema versioning
- Dead letter queues
- Distributed tracing (Jaeger)

### 3.3. Hybrid Approach (Best of Both Worlds)

**ITS Strategy:**

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Synchronous (REST) for:                â”‚
â”‚  âœ“ User-facing operations (â‰¤500ms)      â”‚
â”‚  âœ“ Queries (read operations)            â”‚
â”‚  âœ“ Immediate feedback required          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              +
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Asynchronous (Events) for:             â”‚
â”‚  âœ“ Background processing                â”‚
â”‚  âœ“ Model updates (1-2s acceptable)      â”‚
â”‚  âœ“ Cross-service notifications          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
              =
    â­ Optimized Architecture â­
```

---

## 4. Mapping Tá»›i Architecture Characteristics

### 4.1. Component-Connector View Supports ACs

| **Architecture Characteristic** | **How Component-Connector View Supports It** |
|---------------------------------|----------------------------------------------|
| **AC1: Modularity** | - Each service is independently deployable<br>- Clear boundaries via API contracts<br>- Event-driven decoupling |
| **AC2: Scalability** | - Services scale independently<br>- Kafka enables async processing<br>- Stateless services (easy horizontal scaling) |
| **AC3: Performance** | - Hybrid sync/async patterns<br>- Caching strategies (Redis)<br>- Non-blocking async for background tasks |
| **AC4: Testability** | - Services can be tested independently<br>- Mock external dependencies<br>- Contract testing for APIs |
| **AC5: Deployability** | - Independent deployment per service<br>- Blue/green deployment possible<br>- Canary releases per service |
| **AC6: Security** | - Centralized auth at API Gateway<br>- Service-to-service auth (mTLS possible)<br>- Network segmentation |

### 4.2. Architecture Quantum Analysis

| **Service** | **Quantum Type** | **Coupling** | **Cohesion** |
|-------------|------------------|--------------|--------------|
| Adaptive Engine | **Independent** | Low (async events) | High (single responsibility: path generation) |
| Scoring Service | **Synchronized** (with Content Service) | Medium (REST query) | High (scoring & feedback) |
| Learner Model | **Event-driven** | Low (consumes events only) | High (model management) |

---

## 5. Káº¿t Luáº­n

### 5.1. Key Takeaways

**Component-and-Connector View Ä‘Ã£ chá»©ng minh:**

1. âœ… **Hybrid Communication Strategy:**
   - **Synchronous (REST)** cho user-facing operations â†’ Äáº£m báº£o **Performance (AC3)**
   - **Asynchronous (Kafka)** cho background processing â†’ Äáº£m báº£o **Scalability (AC2)** vÃ  **Modularity (AC1)**

2. âœ… **Decoupling Through Events:**
   - Scoring Service khÃ´ng trá»±c tiáº¿p gá»i Learner Model Service
   - Sá»­ dá»¥ng Kafka lÃ m intermediary
   - â†’ Giáº£m coupling, tÄƒng resilience

3. âœ… **Performance Optimization:**
   - Critical path (â‰¤500ms) Ä‘Æ°á»£c tá»‘i Æ°u báº±ng caching vÃ  async processing
   - Background tasks khÃ´ng áº£nh hÆ°á»Ÿng user experience
   - â†’ ÄÃ¡p á»©ng NFR vá» latency

4. âœ… **Independent Scalability:**
   - Má»—i service cÃ³ database riÃªng
   - Scale theo nhu cáº§u thá»±c táº¿ (vÃ­ dá»¥: scale Scoring Service khi cÃ³ nhiá»u submissions)
   - â†’ Tá»‘i Æ°u chi phÃ­ infrastructure

### 5.2. Architecture Decision Rationale

**Q: Táº¡i sao khÃ´ng dÃ¹ng toÃ n bá»™ REST?**
- A: REST Ä‘á»“ng bá»™ sáº½ lÃ m Scoring Service chá» Ä‘á»£i Learner Model Service cáº­p nháº­t xong â†’ Latency cao, vi pháº¡m Performance (AC3)

**Q: Táº¡i sao khÃ´ng dÃ¹ng toÃ n bá»™ Event-Driven?**
- A: User cáº§n feedback ngay láº­p tá»©c. Eventual consistency khÃ´ng cháº¥p nháº­n Ä‘Æ°á»£c cho real-time feedback.

**Q: Táº¡i sao cáº§n API Gateway?**
- A: Centralized auth, routing, rate limiting â†’ ÄÆ¡n giáº£n hÃ³a client, tÄƒng security (AC6)

### 5.3. Next Steps

GÃ³c nhÃ¬n Component-and-Connector Ä‘Ã£ xÃ¡c Ä‘á»‹nh:
- âœ… Service boundaries
- âœ… Communication patterns
- âœ… Data flow

**Tiáº¿p theo:** 
- Allocation View sáº½ mÃ´ táº£ cÃ¡ch deploy cÃ¡c services nÃ y lÃªn infrastructure
- Implementation view sáº½ chi tiáº¿t code organization

---

**TÃ i liá»‡u tham kháº£o:**
- Software Architecture in Practice (Len Bass et al.)
- The C4 Model for Visualising Software Architecture (Simon Brown)
- Building Event-Driven Microservices (Adam Bellemare)
